import pandas as pd
from statsmodels.tsa.holtwinters import ExponentialSmoothing
import matplotlib.pyplot as plt

# Step 1: Load the Excel file
file_path = '/Users/deepali/cleaned_data.xlsx'  # Update with your actual file path
df_cleaned = pd.read_excel(file_path)

# Step 2: Ensure the data has a proper time column
# Adding a simulated 'Date' column for time-series purposes (if no real 'Date' column exists)
df_cleaned['Date'] = pd.date_range(start='2020-01-01', periods=len(df_cleaned), freq='D')
df_time_series = df_cleaned[['Date', 'Demand']].sort_values(by='Date')

# Step 3: Set the 'Date' column as the index for time series analysis
df_time_series.set_index('Date', inplace=True)

# Step 4: Fit the Exponential Smoothing model
model = ExponentialSmoothing(
    df_time_series['Demand'], 
    trend='add', 
    seasonal='add', 
    seasonal_periods=365  # Assuming yearly seasonality
)
model_fit = model.fit()

# Step 5: Forecast the next 30 days
forecast = model_fit.forecast(30)

# Step 6: Plot the actual data and forecasted values
plt.figure(figsize=(12, 6))
plt.plot(df_time_series['Demand'], label='Actual Demand', color='blue')
plt.plot(forecast, label='Forecasted Demand', linestyle='--', color='orange')
plt.title('Drug Demand Forecasting (Exponential Smoothing)')
plt.xlabel('Date')
plt.ylabel('Demand')
plt.legend()
plt.show()

# Step 7: Print the last 10 forecasted values
print("Last 10 Forecasted Values:")
print(forecast.tail(10))
